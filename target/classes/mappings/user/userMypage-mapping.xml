<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="UserMypageDAO">
<resultMap type="ReviewVO" id="reviewVO">
		<id column="UR_CODE" property="ur_code" jdbcType="VARCHAR"/>
		<result column="U_ID" property="u_id" jdbcType="INTEGER" />
		<result column="STR_CODE" property="str_code" jdbcType="VARCHAR" />
		<result column="UR_REGDATE" property="ur_regdate" jdbcType="TIMESTAMP"/>
		<result column="UR_STAR" property="ur_star" jdbcType="INTEGER"/>
		<result column="UR_PIC_URL" property="ur_pic_url" jdbcType="VARCHAR" />
		<result column="UR_CONTENT" property="ur_content" jdbcType="VARCHAR" />
		<result column="O_CODE" property="o_code" jdbcType="VARCHAR" />
		<result column="UR_OPEN" property="ur_open" jdbcType="BOOLEAN" />
		<result column="UR_ANS" property="ur_ans" jdbcType="VARCHAR" />
		<result column="O_LIST" property="o_list" jdbcType="VARCHAR" />
		
		<result column="SI_NAME" property="si_name" jdbcType="VARCHAR" />
		<result column="SI_LOC" property="si_loc" jdbcType="VARCHAR" />
		
		<result column="DIF_DATE" property="dif_date" jdbcType="VARCHAR" />

	</resultMap>
	
	<select id="reviewList" resultType="ReviewVO" resultMap="reviewVO">
		SELECT UR.*, O.O_LIST, SI.SI_NAME, SI.SI_LOC, SPLIT_PART((CURRENT_TIMESTAMP - UR.UR_REGDATE::DATE)::VARCHAR,' ', 1) AS DIF_DATE
		FROM USER_REVIEW UR JOIN ORDERS O ON UR.O_CODE = O.O_CODE JOIN STORE_INFO SI ON SI.SI_CODE = O.SI_CODE 
		WHERE UR.U_ID = #{u_id} ORDER BY UR_REGDATE DESC;
	</select>
	
	
	
	<insert id="insertReview" parameterType="reviewVO">
		INSERT INTO USER_REVIEW
			VALUES(#{o_code}, #{u_id}, 
				(SELECT SI_CODE FROM ORDERS WHERE O_CODE = #{o_code}), 
				DEFAULT, #{ur_star}, #{ur_pic_url}, #{ur_content}, #{o_code}, DEFAULT, DEFAULT)
	</insert>
	<select id="userPointList" resultType="PointVO">
		SELECT * FROM 
		POINT a 
		INNER JOIN 
		USERS b ON (a.U_ID = b.U_ID)
		INNER JOIN 
		STORE_INFO c ON (a.SI_CODE = c.SI_CODE)
		WHERE a.U_ID = #{u_id}
		ORDER BY PT_SEQ DESC
	</select>
	
	<insert id="myWish" parameterType="UserWishVO">
		INSERT INTO LIKE_STORE
			(U_ID, SI_CODE)
			VALUES(#{u_id}, #{si_code})
	</insert>
</mapper>
 