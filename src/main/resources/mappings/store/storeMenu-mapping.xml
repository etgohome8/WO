<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="SMenuDAO">
	<select id="storeMenuList" resultType="StoreMenuVO" parameterType="StoreMenuVO">
		SELECT * FROM MENU_GROUP g
		INNER JOIN
		MENU m
		ON (m.MG_CODE = g.MG_CODE )
		WHERE m.SI_CODE = #{storeName}
		ORDER BY g.MG_SEQ
	</select>
	
	<select id="storeMgList" resultType="StoreMenuGroupVO" parameterType="StoreMenuGroupVO">
		SELECT * FROM menu_group
		WHERE SI_CODE = #{storeName}
		ORDER BY MG_SEQ
	</select>
	<select id="maxMgSeq" resultType="String">
		SELECT MG_CODE FROM MENU_GROUP 
		WHERE 
		MG_SEQ = (SELECT MAX(MG_SEQ) FROM MENU_GROUP 
		WHERE 
		SI_CODE = #{si_code})
	</select>
	<select id="maxMenuSeq" resultType="String">
		SELECT M_CODE FROM MENU 
		WHERE 
		M_SEQ = (SELECT MAX(M_SEQ) FROM MENU 
		WHERE 
		SI_CODE = #{si_code} and MG_CODE = #{mg_code})
	</select>
	<select id="maxOgbSeq" resultType="String">
		SELECT OGB_CODE FROM OPTIONGROUP_BASIC 
		WHERE 
		OGB_SEQ = (SELECT MAX(OGB_SEQ) FROM OPTIONGROUP_BASIC 
		WHERE 
		SI_CODE = #{si_code})
	</select>
	<select id="maxOpbSeq" resultType="String">
		SELECT OPB_CODE FROM OPTION_BASIC 
		WHERE 
		OPB_SEQ = (SELECT MAX(OPB_SEQ) FROM OPTION_BASIC 
		WHERE 
		SI_CODE = #{si_code} and 
		OGB_SEQ = (SELECT OGB_SEQ FROM OPTIONGROUP_BASIC WHERE OGB_CODE = #{ogb_code}))
	</select>
	
	<insert id="insertMgName" >
		INSERT INTO
    	menu_group(SI_CODE, MG_CODE, MG_NAME) VALUES (#{si_code},#{mg_code} ,#{mg_name})
	</insert>
	
	<select id="ogList" resultType="StoreOptionGroupVO" parameterType="StoreOptionGroupVO">
		SELECT * FROM option_group 
		WHERE SI_CODE = #{storeName}
		ORDER BY OG_SEQ
	</select>
	
	
	<select id="optionList" resultType="StoreOptionVO" parameterType="StoreOptionVO">
		SELECT * FROM options op
		INNER JOIN
		option_group og
		ON (op.OG_SEQ = og.OG_SEQ )
		WHERE og.SI_CODE = #{storeName}
		ORDER BY OP_SEQ
	</select>
	
	
	<select id="MAOList" resultType="MenuAndOptionVO" parameterType="MenuAndOptionVO">
		SELECT * FROM menuandoption 
		WHERE SI_CODE = #{storeName}
	</select>
	
	<select id="basicOpList" resultType="MenuBasicOptionVO" parameterType="MenuBasicOptionVO">
		SELECT * FROM optiongroup_basic ogb
		INNER JOIN
		option_basic opb
		ON (ogb.OGB_SEQ = opb.OGB_SEQ )
		WHERE ogb.SI_CODE = #{storeName}
	</select>
	
	<delete id="deleteMenuGroup">
		DELETE FROM MENU_GROUP 
		WHERE
		SI_CODE = #{si_code}
		AND
		MG_CODE = #{mg_code}
	</delete>
	<delete id="deleteMenuGroup_MAO">
		DELETE FROM MENUANDOPTION
		WHERE
		SI_CODE = #{si_code}
		AND
		MG_CODE = #{mg_code}
	</delete>
	<update id="updateMenuGroup">
		UPDATE MENU_GROUP
		SET MG_NAME = #{mg_name}
		WHERE
		SI_CODE = #{si_code}
		AND
		MG_CODE = #{mg_code}
	</update>
	<update id="updateMenuGroup_MAO">
		UPDATE MENUANDOPTION
		SET MG_NAME = #{mg_name}
		WHERE
		SI_CODE = #{si_code}
		AND
		MG_CODE = #{mg_code}
	</update>
	<insert id="insertMenu">
		INSERT INTO
    	MENU(SI_CODE, M_CODE, M_NAME,MG_CODE,MG_SEQ) 
    	VALUES 
    	(#{si_code},#{m_code} ,#{m_name},#{mg_code} ,#{mg_seq})
	</insert>
	
	<insert id="insertOGB">
		INSERT INTO
    	OPTIONGROUP_BASIC(SI_CODE, M_CODE, M_NAME,OGB_CODE,M_SEQ) 
    	VALUES 
    	(#{si_code},#{m_code} ,#{m_name},#{ogb_code} ,#{m_seq})
	</insert>
	
	<insert id="insertOPB">
		INSERT INTO
    	OPTION_BASIC(SI_CODE, OGB_SEQ, OPB_CODE,OPB_NAME,OPB_PRICE) 
    	VALUES 
    	(#{si_code},#{ogb_seq} ,#{opb_code},#{opb_name} ,#{opb_price})
	</insert>
	
	<select id="getm_seq" resultType="int">
		SELECT M_SEQ FROM MENU
		WHERE SI_CODE = #{si_code}
		AND
		M_CODE =#{m_code}
	</select>
	<select id="getogb_seq" resultType="int">
		SELECT OGB_SEQ FROM OPTIONGROUP_BASIC
		WHERE SI_CODE = #{si_code}
		AND
		OGB_CODE =#{ogb_code}
	</select>
	
</mapper>
 